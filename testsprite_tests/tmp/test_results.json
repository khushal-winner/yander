[
  {
    "projectId": "49403c60-329d-46a9-8035-4c23f5237ffc",
    "testId": "4a918104-cb69-410c-914f-a77235f5fc7c",
    "userId": "d4982478-8071-7067-b4e3-4db0f33776a0",
    "title": "TC001-get root endpoint returns hello message",
    "description": "Verify that a GET request to the root endpoint '/' returns a 200 status code with a JSON response containing {\"message\":\"Hello World\"}.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:8000\"\nAUTH_USERNAME = \"test@test.com\"\nTIMEOUT = 30\n\ndef test_get_root_endpoint_returns_hello_message():\n    try:\n        response = requests.get(\n            f\"{BASE_URL}/\",\n            auth=HTTPBasicAuth(AUTH_USERNAME, ''),\n            timeout=TIMEOUT\n        )\n        # Assert status code\n        assert response.status_code == 200, f\"Expected status code 200 but got {response.status_code}\"\n        # Assert response json content\n        json_data = response.json()\n        assert json_data == {\"message\": \"Hello World\"}, f\"Expected JSON {{'message': 'Hello World'}} but got {json_data}\"\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\ntest_get_root_endpoint_returns_hello_message()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-16T13:58:17.861Z",
    "modified": "2026-02-16T13:58:29.859Z"
  },
  {
    "projectId": "49403c60-329d-46a9-8035-4c23f5237ffc",
    "testId": "e03a678b-9fa4-4103-8034-fcf90dc22ffd",
    "userId": "d4982478-8071-7067-b4e3-4db0f33776a0",
    "title": "TC002-post users creates new user successfully",
    "description": "Test that a POST request to '/users' with a valid email and name creates a new user record and returns a 200 status code with the user object including id, email, name, createdAt, and updatedAt fields.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_post_users_creates_new_user_successfully():\n    url = f\"{BASE_URL}/users\"\n    payload = {\n        \"email\": \"testuser+tc002@example.com\",\n        \"name\": \"Test User TC002\"\n    }\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n    try:\n        data = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    # Validate presence and types of fields\n    for field in ['id', 'email', 'name', 'createdAt', 'updatedAt']:\n        assert field in data, f\"Response JSON missing '{field}' field\"\n        assert isinstance(data[field], str), f\"Field '{field}' should be a string\"\n    assert data['email'] == payload['email'], \"Response email does not match request\"\n    assert data['name'] == payload['name'], \"Response name does not match request\"\n\n    # Cleanup: delete created user by ID\n    user_id = data['id']\n    delete_url = f\"{BASE_URL}/users/{user_id}\"\n    try:\n        del_response = requests.delete(delete_url, timeout=TIMEOUT)\n        # Allow 200 or 204 as successful delete responses\n        assert del_response.status_code in (200, 204), f\"Failed to delete user in cleanup, status: {del_response.status_code}\"\n    except requests.RequestException as e:\n        assert False, f\"Cleanup delete request failed: {e}\"\n\ntest_post_users_creates_new_user_successfully()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 44, in <module>\n  File \"<string>\", line 21, in test_post_users_creates_new_user_successfully\nAssertionError: Expected status code 200, got 400\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-16T13:58:17.865Z",
    "modified": "2026-02-16T13:58:47.696Z"
  },
  {
    "projectId": "49403c60-329d-46a9-8035-4c23f5237ffc",
    "testId": "e1a8d066-f8cc-4bfc-9bc2-11602635b1e7",
    "userId": "d4982478-8071-7067-b4e3-4db0f33776a0",
    "title": "TC003-post users missing email returns error",
    "description": "Ensure that a POST request to '/users' with a missing email field in the request body returns a 400 status code with a JSON error message.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:8000\"\nAUTH_USERNAME = \"test@test.com\"\nTIMEOUT = 30\n\ndef test_post_users_missing_email_returns_error():\n    url = f\"{BASE_URL}/users\"\n    headers = {\"Content-Type\": \"application/json\"}\n    payload = {\"name\": \"Bob\"}  # Missing email field\n    auth = HTTPBasicAuth(AUTH_USERNAME, '')\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, auth=auth, timeout=TIMEOUT)\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\n    assert response.status_code == 400, f\"Expected status code 400, got {response.status_code}\"\n    try:\n        resp_json = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    assert \"error\" in resp_json, \"Response JSON does not contain 'error' key\"\n    assert isinstance(resp_json[\"error\"], str) and len(resp_json[\"error\"]) > 0, \"'error' value should be a non-empty string\"\n\ntest_post_users_missing_email_returns_error()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-16T13:58:17.870Z",
    "modified": "2026-02-16T13:58:31.004Z"
  },
  {
    "projectId": "49403c60-329d-46a9-8035-4c23f5237ffc",
    "testId": "c4cd0045-cf1b-428d-b923-3085bdb8a082",
    "userId": "d4982478-8071-7067-b4e3-4db0f33776a0",
    "title": "TC004-post users duplicate email returns unique constraint error",
    "description": "Verify that attempting to create a user with an email that already exists in the database via POST '/users' returns a 400 status code with an error message indicating a unique constraint failure on the email field.",
    "code": "import requests\n\nbase_url = \"http://localhost:8000\"\ntimeout = 30\n\ndef test_post_users_duplicate_email_returns_unique_constraint_error():\n    created_user_id = None\n    user_email = \"duplicateuser@example.com\"\n    headers = {\"Content-Type\": \"application/json\"}\n\n    # Step 1: Create a new user with the email to ensure duplication\n    create_payload = {\n        \"email\": user_email,\n        \"name\": \"Original User\"\n    }\n    try:\n        create_response = requests.post(\n            f\"{base_url}/users\",\n            json=create_payload,\n            headers=headers,\n            timeout=timeout\n        )\n        assert create_response.status_code == 200, f\"Initial user creation failed with status {create_response.status_code}\"\n        created_user = create_response.json()\n        created_user_id = created_user.get(\"id\")\n        assert created_user_id, \"Created user ID not found in response\"\n\n        # Step 2: Attempt to create another user with the same email\n        duplicate_payload = {\n            \"email\": user_email,\n            \"name\": \"Duplicate User\"\n        }\n        duplicate_response = requests.post(\n            f\"{base_url}/users\",\n            json=duplicate_payload,\n            headers=headers,\n            timeout=timeout\n        )\n        # Validate status code and error message\n        assert duplicate_response.status_code == 400, f\"Expected 400 status for duplicate email, got {duplicate_response.status_code}\"\n        error_body = duplicate_response.json()\n        assert \"error\" in error_body, \"Error message key missing in response\"\n        assert \"Unique constraint failed on the fields: (email)\" in error_body[\"error\"], \\\n            f\"Unexpected error message: {error_body['error']}\"\n\n    finally:\n        # Cleanup: Delete the created user if exists\n        if created_user_id:\n            try:\n                requests.delete(\n                    f\"{base_url}/users/{created_user_id}\",\n                    timeout=timeout\n                )\n            except Exception:\n                pass  # Ignore cleanup errors silently\n\ntest_post_users_duplicate_email_returns_unique_constraint_error()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 57, in <module>\n  File \"<string>\", line 23, in test_post_users_duplicate_email_returns_unique_constraint_error\nAssertionError: Initial user creation failed with status 400\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-16T13:58:17.874Z",
    "modified": "2026-02-16T13:58:48.229Z"
  },
  {
    "projectId": "49403c60-329d-46a9-8035-4c23f5237ffc",
    "testId": "83016c44-17b8-445b-94e5-57592ddcf146",
    "userId": "d4982478-8071-7067-b4e3-4db0f33776a0",
    "title": "TC005-post users invalid email format allowed",
    "description": "Confirm that the current implementation allows creating a user with an invalid email format via POST '/users' and returns a 200 status code with the created user object, as email format validation is not enforced.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:8000\"\nAUTH_USERNAME = \"test@test.com\"\n\ndef test_post_users_invalid_email_format_not_allowed():\n    url = f\"{BASE_URL}/users\"\n    headers = {\"Content-Type\": \"application/json\"}\n    payload = {\n        \"email\": \"invalid-email-format\",\n        \"name\": \"Eve\"\n    }\n    auth = HTTPBasicAuth(AUTH_USERNAME, \"\")\n\n    response = requests.post(url, json=payload, headers=headers, auth=auth, timeout=30)\n    assert response.status_code == 400, f\"Expected status code 400 but got {response.status_code}\"\n\n    error_resp = response.json()\n    assert isinstance(error_resp, dict), \"Response JSON is not a dictionary\"\n    assert \"error\" in error_resp and isinstance(error_resp[\"error\"], str) and error_resp[\"error\"], \"Error message missing or invalid\"\n\n\ntest_post_users_invalid_email_format_not_allowed()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-16T13:58:17.878Z",
    "modified": "2026-02-16T13:58:41.897Z"
  },
  {
    "projectId": "49403c60-329d-46a9-8035-4c23f5237ffc",
    "testId": "d622aa84-98eb-489c-8eda-6dd44bb13c64",
    "userId": "d4982478-8071-7067-b4e3-4db0f33776a0",
    "title": "TC006-get error endpoint returns server error",
    "description": "Test that a GET request to '/error' triggers the global error handler and returns a 500 status code with a JSON response containing {\"error\":\"Something broke!\"}.",
    "code": "import requests\n\ndef test_get_error_endpoint_returns_server_error():\n    base_url = \"http://localhost:8000\"\n    url = f\"{base_url}/error\"\n    headers = {\n        \"Accept\": \"application/json\"\n    }\n    try:\n        response = requests.get(url, headers=headers, timeout=30)\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\n    assert response.status_code == 500, f\"Expected status code 500 but got {response.status_code}\"\n    try:\n        json_response = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    expected_response = {\"error\": \"Something broke!\"}\n    assert json_response == expected_response, f\"Expected response {expected_response} but got {json_response}\"\n\ntest_get_error_endpoint_returns_server_error()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 23, in <module>\n  File \"<string>\", line 14, in test_get_error_endpoint_returns_server_error\nAssertionError: Expected status code 500 but got 404\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-16T13:58:17.882Z",
    "modified": "2026-02-16T13:58:43.931Z"
  },
  {
    "projectId": "49403c60-329d-46a9-8035-4c23f5237ffc",
    "testId": "bab277b5-523a-4409-a4eb-5b45b8d24f73",
    "userId": "d4982478-8071-7067-b4e3-4db0f33776a0",
    "title": "TC007-post users db failure returns server error",
    "description": "Simulate a database connection failure during a POST request to '/users' and verify that the global error handler returns a 500 status code with a JSON error message.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\ndef test_post_users_db_failure_returns_server_error():\n    base_url = \"http://localhost:8000\"\n    url = f\"{base_url}/users\"\n\n    auth = HTTPBasicAuth('test@test.com', '')\n    headers = {\n        \"Content-Type\": \"application/json\",\n    }\n\n    # Payload for user creation\n    payload = {\n        \"email\": \"simulate-db-failure@example.com\",\n        \"name\": \"DB Failure Test\"\n    }\n\n    # To simulate a DB failure, we expect the test environment or server\n    # to be configured accordingly (e.g. by mocking prisma or the DB connection).\n    # Since we only have API-level access here, we send the request and assert\n    # a 500 error with a JSON error message is returned.\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, auth=auth, timeout=30)\n    except requests.RequestException as e:\n        assert False, f\"Request failed with exception: {e}\"\n\n    assert response.status_code == 500, f\"Expected status code 500, got {response.status_code}\"\n\n    try:\n        json_response = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    assert \"error\" in json_response and isinstance(json_response[\"error\"], str) and len(json_response[\"error\"]) > 0, \\\n        \"Response JSON must contain a non-empty 'error' string field\"\n\ntest_post_users_db_failure_returns_server_error()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 39, in <module>\n  File \"<string>\", line 29, in test_post_users_db_failure_returns_server_error\nAssertionError: Expected status code 500, got 400\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-16T13:58:17.886Z",
    "modified": "2026-02-16T13:58:38.765Z"
  }
]
